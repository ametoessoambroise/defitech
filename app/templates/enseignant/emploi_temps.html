{% extends "base.html" %} {% block title %}{{ current_user.nom }} {{
current_user.prenom }} | DEFITECH{% endblock %} {% block content %}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="bg-white rounded-lg shadow">
    <div
      class="px-6 py-4 border-b border-gray-200 flex items-center justify-between"
    >
      <div>
        <h2 class="text-xl font-semibold text-gray-900">Mon Emploi du Temps</h2>
        <p class="text-sm text-gray-600 mt-1">
          Consultez votre planning hebdomadaire
        </p>
      </div>
      <button
        id="refresh-emploi"
        class="inline-flex items-center px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
      >
        <i class="fas fa-sync-alt mr-2"></i>Actualiser
      </button>
    </div>

    <div class="p-6">
      <div class="overflow-x-auto">
        <table
          id="timetable-enseignant"
          class="min-w-full border border-gray-200"
        >
          <thead id="timetable-head-enseignant">
            <!-- Rempli via JS -->
          </thead>
          <tbody
            id="timetable-body-enseignant"
            class="bg-white divide-y divide-gray-200"
          >
            <!-- Rempli via JS -->
          </tbody>
        </table>
      </div>

      <!-- Légende -->
      <div class="mt-6 p-4 bg-gray-50 rounded-lg">
        <h4 class="font-medium text-gray-900 mb-3">Légende</h4>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="flex items-center">
            <div class="w-4 h-4 bg-blue-100 rounded mr-2"></div>
            <span class="text-sm text-gray-700">Cours magistral</span>
          </div>
          <div class="flex items-center">
            <div class="w-4 h-4 bg-pink-100 rounded mr-2"></div>
            <span class="text-sm text-gray-700">Travaux pratiques</span>
          </div>
          <div class="flex items-center">
            <div class="w-4 h-4 bg-red-100 rounded mr-2"></div>
            <span class="text-sm text-gray-700">Laboratoire</span>
          </div>
          <div class="flex items-center">
            <div class="w-4 h-4 bg-cyan-100 rounded mr-2"></div>
            <span class="text-sm text-gray-700">Sport</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const head = document.getElementById("timetable-head-enseignant");
    const body = document.getElementById("timetable-body-enseignant");
    const refreshBtn = document.getElementById("refresh-emploi");

    async function loadEmploiTempsEnseignant() {
      if (!head || !body) return;
      head.innerHTML = "";
      body.innerHTML = "";

      try {
        const response = await fetch(
          "{{ url_for('teachers.api_emploi_temps') }}"
        );
        if (!response.ok) {
          console.error("Erreur API enseignant:", response.statusText);
          return;
        }

        const data = await response.json();
        const jours = data.jours || [];
        const horaires = data.horaires || [];
        const creneaux = data.creneaux || [];

        // Entête
        const headerRow = document.createElement("tr");
        headerRow.className = "bg-gray-50";

        const thHoraire = document.createElement("th");
        thHoraire.className =
          "px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border border-gray-200";
        thHoraire.textContent = "Horaire";
        headerRow.appendChild(thHoraire);

        jours.forEach((jour) => {
          const th = document.createElement("th");
          th.className =
            "px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border border-gray-200";
          th.textContent = jour;
          headerRow.appendChild(th);
        });

        head.appendChild(headerRow);

        // Lignes
        horaires.forEach((horaireLabel) => {
          const row = document.createElement("tr");

          const tdHoraire = document.createElement("td");
          tdHoraire.className =
            "px-4 py-3 text-sm font-medium text-gray-900 border border-gray-200";
          tdHoraire.textContent = horaireLabel;
          row.appendChild(tdHoraire);

          jours.forEach((jour) => {
            const td = document.createElement("td");
            td.className = "px-4 py-3 border border-gray-200";

            const match = creneaux.find(
              (c) => c.jour === jour && c.horaire === horaireLabel
            );
            if (match) {
              const div = document.createElement("div");
              div.className = "bg-blue-100 p-3 rounded-lg";
              div.innerHTML = `
                <p class="font-medium text-blue-900">${match.matiere || ""}</p>
                <p class="text-sm text-blue-700">${match.salle || ""}</p>
              `;
              td.appendChild(div);
            }

            row.appendChild(td);
          });

          body.appendChild(row);
        });
      } catch (error) {
        console.error("Erreur chargement emploi du temps enseignant:", error);
      }
    }

    refreshBtn?.addEventListener("click", function () {
      loadEmploiTempsEnseignant();
    });

    loadEmploiTempsEnseignant();
  });
</script>

{% endblock %}
