{% extends "admin/base.html" %} {% block title %}{{ current_user.nom }} {{
current_user.prenom }} | DEFITECH{% endblock %} {% block content %}

<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-6 flex items-center justify-between flex-wrap gap-4">
    <h1 class="text-2xl font-bold text-gray-900">Ajouter un étudiant</h1>
    <button
      onclick="history.back()"
      class="text-green-600 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition duration-150 flex items-center"
    >
      <i class="fas fa-arrow-left mr-2"></i>
      Retour
    </button>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %} {% for category, message in messages %}
  <div
    class="mb-4 p-4 rounded-lg {% if category == 'error' %}bg-red-100 border border-red-400 text-red-700{% elif category == 'success' %}bg-green-100 border border-green-400 text-green-700{% else %}bg-blue-100 border border-blue-400 text-blue-700{% endif %}"
  >
    {{ message }}
  </div>
  {% endfor %} {% endif %} {% endwith %}

  <div class="bg-white rounded-lg shadow p-6">
    <form method="POST" class="space-y-6">
      <input
        type="hidden"
        name="csrf_token"
        id="csrf_token"
        value="{{ csrf_token() }}"
      />

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="nom" class="block text-sm font-medium text-gray-700 mb-2"
            >Nom <span class="text-red-500">*</span></label
          >
          <input
            type="text"
            id="nom"
            name="nom"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Nom de famille"
          />
        </div>
        <div>
          <label
            for="prenom"
            class="block text-sm font-medium text-gray-700 mb-2"
            >Prénom <span class="text-red-500">*</span></label
          >
          <input
            type="text"
            id="prenom"
            name="prenom"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Prénom"
          />
        </div>
        <div>
          <label
            for="email"
            class="block text-sm font-medium text-gray-700 mb-2"
            >Email <span class="text-red-500">*</span></label
          >
          <input
            type="email"
            id="email"
            name="email"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
            placeholder="exemple@email.com"
          />
        </div>
        <div>
          <label
            for="password"
            class="block text-sm font-medium text-gray-700 mb-2"
            >Mot de passe <span class="text-red-500">*</span></label
          >
          <input
            type="password"
            id="password"
            name="password"
            required
            minlength="6"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Mot de passe"
          />
        </div>
        <div>
          <label
            for="date_naissance"
            class="block text-sm font-medium text-gray-700 mb-2"
            >Date de naissance <span class="text-red-500">*</span></label
          >
          <input
            type="date"
            id="date_naissance"
            name="date_naissance"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
          />
        </div>
        <div>
          <label for="sexe" class="block text-sm font-medium text-gray-700 mb-2"
            >Sexe <span class="text-red-500">*</span></label
          >
          <select
            id="sexe"
            name="sexe"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="">-- Sélectionner --</option>
            <option value="Homme">Homme</option>
            <option value="Femme">Femme</option>
            <option value="Autre">Autre</option>
          </select>
        </div>
        <div>
          <label for="age" class="block text-sm font-medium text-gray-700 mb-2"
            >Âge <span class="text-red-500">*</span></label
          >
          <input
            type="number"
            id="age"
            name="age"
            min="15"
            max="100"
            readonly
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Automatique"
          />
        </div>
        <div>
          <label
            for="filiere"
            class="block text-sm font-medium text-gray-700 mb-2"
            >Filière <span class="text-red-500">*</span></label
          >
          <select
            id="filiere"
            name="filiere"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="">-- Sélectionner --</option>
            {% for f in filieres %}
            <option value="{{ f.nom }}">{{ f.nom }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label
            for="annee"
            class="block text-sm font-medium text-gray-700 mb-2"
            >Année <span class="text-red-500">*</span></label
          >
          <select
            id="annee"
            name="annee"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="">-- Sélectionner --</option>
            {% for a in annees %}
            <option value="{{ a.nom }}">{{ a.nom }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
        <a
          href="{{ url_for('admin.admin_etudiants') }}"
          class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-300 focus:outline-none focus:ring-1 focus:ring-red-500"
          >Annuler</a
        >
        <button
          type="submit"
          class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-1 focus:ring-offset-2 focus:ring-blue-500"
        >
          Ajouter l'étudiant
        </button>
      </div>
    </form>
  </div>
</div>
{% block extra_js %}
<script>
  document
    .getElementById("date_naissance")
    .addEventListener("change", function () {
      const dateNaissance = this.value;
      if (dateNaissance) {
        const birthDate = new Date(dateNaissance);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const m = today.getMonth() - birthDate.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
          age--;
        }
        document.getElementById("age").value = age > 0 ? age : "";
      } else {
        document.getElementById("age").value = "";
      }
    });
</script>
{% endblock %} {% endblock %}
